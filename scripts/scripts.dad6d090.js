"use strict";angular.module("mediosSuciosFrontApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngMaterial","restangular","ngMessages","chart.js","prismic.io"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"vm"}).when("/content/:contentSlug",{templateUrl:"views/content.html",controller:"ContentCtrl",controllerAs:"vm"}).when("/contacto",{templateUrl:"views/contacto.html",controller:"ContactoCtrl",controllerAs:"vm"}).when("/aviso-de-privacidad",{templateUrl:"views/aviso-de-privacidad.html",controller:"AvisoDePrivacidadCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),moment.locale("es")}]).config(["RestangularProvider",function(a){a.setBaseUrl("https://medios-sucios-api.herokuapp.com/")}]).config(["$mdThemingProvider",function(a){var b=a.extendPalette("indigo",{500:"#2D303A"});a.definePalette("pinkMS",b),a.theme("default").primaryPalette("pinkMS")}]).config(["ChartJsProvider",function(a){a.setOptions({colors:["#f0b4bd","#fff","#DCDCDC","#46BFBD","#FDB45C","#949FB1","#4D5360"]})}]).config(["PrismicProvider",function(a){a.setApiEndpoint("https://medios-sucios.prismic.io/api"),a.setLinkResolver(function(a,b){return"#!/content/"+b.id+"&slug="+b.slug+a.maybeRefParam})}]),angular.module("mediosSuciosFrontApp").controller("MainCtrl",["msApiService","metadataService","$mdSidenav","$filter","Prismic",function(a,b,c,d,e){function f(){return l.loadingReports=!0,a.getReports().then(l.setReports)}function g(){l.getReports(),l.setupCharts(),l.motives=[{title:"Étnia"},{title:"Nacionalidad"},{title:"Clase"},{title:"Género"},{title:"Religión"},{title:"Orientación Sexual"},{title:"Discapacidad"}],e.all().then(function(a){l.pages=a.results,l.generalContent=l.pages.find(function(a){return"contenido_general"===a.type}),l.pages=l.pages.filter(function(a){return"pagina"===a.type})})}function h(a){return l.loadingReports=!1,l.reports=a.map(function(a){return a.info=b.getBasicInfo(a.metadata),a}),l.reports}function i(){l.reporting=!0,a.submitReport(l.report).then(function(a){l.reporting=!1,l.metadata=a,l.toggleSidenav(),l.getReports()})}function j(){c("left").toggle()}function k(){a.getSourceCount().then(function(a){var b=a.data;l.sourceData=b.reduce(function(a,b){return{labels:a.labels?a.labels.concat(b._id):[b._id],data:a.data?a.data.concat(b.total):[b.total]}},{}),l.sourceData.options={scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}}).catch(function(a){console.log(a)}),a.getMotiveCount().then(function(a){var b=a.data;l.motiveData=b.reduce(function(a,b){return{labels:a.labels?a.labels.concat(b._id):[b._id],data:a.data?a.data.concat(b.total):[b.total]}},{}),l.motiveData.options={scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}}).catch(function(a){console.log(a)}),a.getDateReportCount().then(function(a){var b=a.data;l.dateData=b.reduce(function(a,b){var c=moment(b._id,"MM").toDate(),e=d("date")(c,"MMMM");return{labels:a.labels?a.labels.concat(e):[e],data:a.data?a.data.concat(b.total):[b.total]}},{})}).catch(function(a){console.log(a)}),l.datesData.labels=["January","February","March","April","May","June","July"],l.datesData.series=["Series A"],l.datesData.data=[[65,59,80,81,56,55,40]],l.datesData.options={scales:{yAxes:[{id:"y-axis-1",type:"linear",display:!0,position:"left"}]}},l.reasonsData.labels=["Sexismo","Racismo","Religioso","Homofobia"],l.reasonsData.series=["Series A"],l.reasonsData.data=[[65,59,80,81,56,55,40]]}var l=this;l.loadingReports=!1,l.report={},l.reporting=!1,l.reports=[],l.getReports=f,l.init=g,l.setReports=h,l.submitReport=i,l.toggleSidenav=j,l.setupCharts=k,l.mediaData={},l.datesData={},l.reasonsData={},l.init()}]),angular.module("mediosSuciosFrontApp").service("msApiService",["$http","Restangular",function(a,b){this.Report=b.all("report"),this.submitReport=function(a){return this.Report.post(a)},this.getReports=function(a){var b={sort:"createdAt DESC"};return angular.extend(b,a),this.Report.getList(b)},this.getSourceCount=function(){var c=b.configuration.baseUrl;return a.get(c+"/sourcecount")},this.getMotiveCount=function(){var c=b.configuration.baseUrl;return a.get(c+"/motivecount")},this.getDateReportCount=function(){var c=b.configuration.baseUrl;return a.get(c+"/datecount")}}]),angular.module("mediosSuciosFrontApp").service("metadataService",function(){this.getBasicInfo=function(a){var b={title:a.general.title,description:a.general.description};return a.openGraph&&(b.title=a.openGraph.title,b.description=a.openGraph.description,a.openGraph.image&&(b.image=a.openGraph.image.url)),b}}),angular.module("mediosSuciosFrontApp").service("prismicService",["$http",function(a){this.getAll=function(){var b={ref:"WTiKMSgAACYA3QJb",format:"json"};return a.get("https://medios-sucios.prismic.io/api/v1/documents/search",{params:b})},this.getByUID=function(b){var c={ref:"WTiKMSgAACYA3QJb",format:"json",q:'[[:d = at(my.pagina.uid, "'+b+'")]]'};return a.get("https://medios-sucios.prismic.io/api/v1/documents/search",{params:c})}}]),angular.module("mediosSuciosFrontApp").controller("ContentCtrl",["Prismic","$routeParams",function(a,b){function c(){a.all().then(f.setPages).then(e)}function d(a){return f.pages=a.results,f.generalContent=f.pages.find(function(a){return"contenido_general"===a.type}),f.pages=f.pages.filter(function(a){return"pagina"===a.type}),f.pages}function e(a){var c=b.contentSlug;f.content=a.find(function(a){return c===a.slug}),console.log(f.content)}var f=this;f.init=c,f.setPages=d,f.findPage=e,f.init()}]),angular.module("mediosSuciosFrontApp").controller("ContactoCtrl",["Prismic","$http",function(a,b){function c(){a.all().then(f.setPages)}function d(a){f.pages=a.results,f.generalContent=f.pages.find(function(a){return"contenido_general"===a.type}),f.pages=f.pages.filter(function(a){return"pagina"===a.type})}function e(){f.reporting=!0,f.done=!1;var a={method:"POST",url:"https://formspree.io/sonny@spaceshiplabs.com",headers:{"Content-Type":"application/json"},data:{name:f.contact.name,email:f.contact.email,message:f.contact.message}};console.log(a),b(a).then(function(a){console.log(a),f.reporting=!1,f.done=!0})}var f=this;f.init=c,f.setPages=d,f.submitContact=e,f.reporting=!1,f.done=!1,f.init()}]),angular.module("mediosSuciosFrontApp").controller("AvisoDePrivacidadCtrl",["Prismic",function(a){function b(){a.all().then(d.setPages)}function c(a){return d.pages=a.results,d.generalContent=d.pages.find(function(a){return"contenido_general"===a.type}),d.pages}var d=this;d.init=b,d.setPages=c,d.init()}]),angular.module("mediosSuciosFrontApp").run(["$templateCache",function(a){a.put("views/aviso-de-privacidad.html",'<div flex layout="row" layout-wrap layout-fill> <ng-include src="&quot;views/mainbox.html&quot;" flex flex-xs="100" flex-sm="100" class="main-box"></ng-include> <ng-include src="&quot;views/sidenav.html&quot;" layout="row" class="sidenav-container"></ng-include> </div> <md-content layout-padding class="main-content"> <h1>Aviso de privacidad</h1> <prismic-html fragment="vm.generalContent.fragments[\'contenido_general.aviso_de_privacidad\']"></prismic-html> </md-content> <ng-include src="&quot;views/footer.html&quot;"></ng-include>'),a.put("views/contacto.html",'<div flex layout="row" layout-wrap layout-fill> <ng-include src="&quot;views/mainbox.html&quot;" flex flex-xs="100" flex-sm="100" class="main-box"></ng-include> <ng-include src="&quot;views/sidenav.html&quot;" layout="row" class="sidenav-container"></ng-include> </div> <md-content layout-padding class="md-padding" layout="row" layout-align="space-around"> <form name="contactForm" ng-submit="vm.submitContact()" class="report-form md-padding" flex="30"> <br> <br> <md-input-container> <label>Nombre</label> <input ng-model="vm.contact.name" ng-disabled="vm.reporting" required name="name"> <div ng-messages="contactForm.name.$error" role="alert"> <div ng-message="required">Este campo es obligatorio.</div> </div> </md-input-container> <md-input-container> <label>Email</label> <input ng-model="vm.contact.email" ng-disabled="vm.reporting" required name="name" type="email"> <div ng-messages="contactForm.email.$error" role="alert"> <div ng-message="email">Por favor ingrese un email valido.</div> <div ng-message="required">Este campo es obligatorio.</div> </div> </md-input-container> <md-input-container class="md-block"> <label>Mensaje</label> <textarea ng-model="vm.contact.message" ng-disabled="vm.reporting" rows="4" md-select-on-focus name="message"></textarea> <div ng-messages="contactForm.message.$error" role="alert"> </div> </md-input-container> <md-button type="submit" class="reportbtn" ng-if="!vm.reporting" layout="row" layout-align="center center">enviar</md-button> <md-progress-circular ng-if="vm.reporting" md-mode="indeterminate"></md-progress-circular> <p ng-if="vm.done">Gracias, su mensaje ha sido enviado. </p> <br> <br> <br> <h3>Para más información contactanos:</h3> <p>512.582.2223 | 01.800.851.7910</p> <p>info@mediossucios.com</p> <br> <br> <br> <br> <br> </form> <iframe flex="40" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3720.6647401440246!2d-86.82321088451178!3d21.165736385924305!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8f4c2ea9f3f4faf9%3A0xa81de67d6865a598!2sCiudadan%40s+por+la+Transparencia!5e0!3m2!1sen!2smx!4v1497540695397" width="600" height="450" frameborder="0" style="border:0" allowfullscreen></iframe> </md-content> <ng-include src="&quot;views/footer.html&quot;"></ng-include>'),a.put("views/content.html",'<div flex layout="row" layout-wrap layout-fill> <ng-include src="&quot;views/mainbox.html&quot;" flex flex-xs="100" flex-sm="100" class="main-box"></ng-include> <ng-include src="&quot;views/sidenav.html&quot;" layout="row" class="sidenav-container"></ng-include> </div> <md-content layout-padding class="main-content"> <prismic-html fragment="vm.content.fragments[\'pagina.titulo\']"></prismic-html> <prismic-html fragment="vm.content.fragments[\'pagina.contenido\']"></prismic-html> </md-content> <ng-include src="&quot;views/footer.html&quot;"></ng-include>'),a.put("views/footer.html",'<div id="footer"> <div class="footer-inner"> <div layout="row"> <div flex="50"> <p> <a href="/"><img class="logo-footer" src="images/Logo-Medios-Sucios2.7459ffec.png" alt="medios sucios"></a> </p> <ul class="sitemap"> <li ng-repeat="page in vm.pages"><a ng-href="#!/content/{{page.slug}}">{{page.fragments[\'pagina.titulo\'].value[0].text}}</a></li> </ul> </div> </div> <div layout="row" layout-align="space-between start" layout-wrap> <div flex="50" flex-sm="100" flex-xs="100"> <p> <a target="_blank" ng-href="{{vm.generalContent.fragments[&quot;contenido_general.instagram_link&quot;].value.url}}"><span class="icon icon-instagram"></span></a> <a target="_blank" ng-href="{{vm.generalContent.fragments[&quot;contenido_general.facebook_link&quot;].value.url}}"><span class="icon icon-facebook"></span></a> <a target="_blank" ng-href="{{vm.generalContent.fragments[&quot;contenido_general.twitter_link&quot;].value.url}}"><span class="icon icon-twitter"></span></a> </p> </div> <div flex-sm="100" flex-xs="100"> <p class="final-links"> <a href="#!/aviso-de-privacidad">Aviso de privacidad</a> <a href="#!/contacto">Contacto</a> </p> <p class="copyright"> <span>&copy; 2017 medios sucios</span> | Todos los derechos reservados </p> </div> </div> </div> </div>'),a.put("views/gridlist.html",'<md-grid-list md-cols="1" md-cols-sm="2" md-cols-md="3" md-cols-gt-md="12" md-row-height-gt-md="1:1" md-row-height="4:3" md-gutter="8px" md-gutter-gt-sm="4px"> <md-grid-tile ng-repeat="report in vm.reports" md-rowspan="3" md-colspan="3" md-colspan-sm="1" md-colspan-xs="1" class="grid-tile"> <div class="md-padding"> <h3>{{report.motive}}</h3> <h4><a ng-href="{{report.link}}">{{ report.info.title }}</a></h4> <p> {{report.info.description}} </p> </div> <md-grid-tile-footer> {{report.source.domain}} </md-grid-tile-footer> </md-grid-tile> </md-grid-list>'),a.put("views/main.html",'<div flex layout="row" layout-wrap layout-fill> <ng-include src="&quot;views/mainbox.html&quot;" flex flex-xs="100" flex-sm="100" class="main-box"></ng-include> <ng-include src="&quot;views/sidenav.html&quot;" layout="row" class="sidenav-container"></ng-include> </div> <div class="charts-section"> <h1>Reportes</h1> <div layout="row" layout-wrap layout-align="space-between center" class="charts-section-inner"> <div flex="33" flex-xs="100" class="chart-item"> <canvas id="bar" class="chart chart-bar" chart-data="vm.sourceData.data" chart-options="vm.sourceData.options" chart-labels="vm.sourceData.labels"> </canvas> <h2>Medios</h2> </div> <div flex="33" flex-xs="100" class="chart-item"> <canvas id="line" class="chart chart-line" chart-data="vm.dateData.data" chart-labels="vm.dateData.labels"> </canvas> <h2>Fecha</h2> </div> <div flex="33" flex-xs="100" class="chart-item"> <canvas id="bar" class="chart chart-bar" chart-data="vm.motiveData.data" chart-labels="vm.motiveData.labels" chart-series="vm.motiveData.series"> </canvas> <h2>Motivo</h2> </div> </div> </div> <div class="title-banner"> <h2>Los marranitos...</h2> </div> <div flex layout="row" layout-fill> <md-content flex class="md-padding" ng-include="&quot;views/simplelist.html&quot;"></md-content> </div> <ng-include src="&quot;views/footer.html&quot;"></ng-include>'),a.put("views/mainbox.html",'<md-toolbar layout="row" class="md-toolbar-tools main-toolbar"> <h1 flex layout="row">Contacto: <prismic-html fragment="vm.generalContent.fragments[\'contenido_general.contacto_header_clave_pais\']"></prismic-html> <span><prismic-html fragment="vm.generalContent.fragments[\'contenido_general.telefono_header\']"></prismic-html></span> </h1> <a target="_blank" ng-href="{{vm.generalContent.fragments[&quot;contenido_general.instagram_link&quot;].value.url}}"><span class="icon icon-instagram"></span></a> <a target="_blank" ng-href="{{vm.generalContent.fragments[&quot;contenido_general.facebook_link&quot;].value.url}}"><span class="icon icon-facebook"></span></a> <a target="_blank" ng-href="{{vm.generalContent.fragments[&quot;contenido_general.twitter_link&quot;].value.url}}"><span class="icon icon-twitter"></span></a> <!--<md-button class=\'md-secondary md-raised\' ng-click=\'vm.toggleSidenav()\' >Reportar</md-button> --> </md-toolbar> <md-content layout="row" layout-wrap class="marquee" layout-fill> <div class="marquee-inner"> <div layout-align="space-between start" layout="row" class="menu-container"> <a ng-repeat="page in vm.pages" ng-href="#!/content/{{page.slug}}">{{page.fragments[\'pagina.titulo\'].value[0].text}}</a> </div> <div class="intro-content"> <h1><strong>Medios sucios</strong> es un sitio que recopila el discurso de odio en medios de latinoamérica</h1> <h2>Haz un reporte</h2> <p> <button class="action-btn"> Conoce más </button> </p> </div> </div> </md-content>'),a.put("views/sidenav.html",'<md-sidenav md-component-id="left" class="md-sidenav-left" md-is-locked-open="$mdMedia(\'gt-md\')" flex layout-fill> <div class="head"> <a href="/"><img src="images/logo1.5eae2d9f.png" alt="medios sucios"></a> </div> <form name="reportForm" ng-submit="vm.submitReport()" class="report-form"> <div class="md-padding"> <h1>¿Cómo participar?</h1> <h2>Simplemente llena el formulario</h2> <div> <md-input-container> <label>URL de el Artículo</label> <input ng-model="vm.report.url" ng-disabled="vm.reporting" required type="url" name="reportUrl"> <div ng-messages="reportForm.reportUrl.$error" role="alert"> <div ng-message="url">Debe ser un URL valido.</div> <div ng-message="required">Este campo es obligatorio.</div> </div> </md-input-container> </div> <div> <md-input-container> <label>Tipo de discriminación</label> <md-select aria-label="motivo" ng-model="vm.report.motive" ng-disabled="vm.reporting" name="reportMotive" class="select-type" required> <md-option ng-repeat="motive in vm.motives" value="{{motive.title}}"> {{motive.title}} </md-option> </md-select> <div ng-messages="reportForm.reportMotive.$error" role="alert"> <div ng-message="required">Este campo es obligatorio.</div> </div> </md-input-container> </div> <md-input-container class="md-block"> <label>Comentario</label> <textarea maxlength="256" ng-model="vm.report.coment" ng-disabled="vm.reporting" md-maxlength="256" rows="4" md-select-on-focus name="reportComment"></textarea> <div ng-messages="reportForm.reportComment.$error" role="alert"> <div ng-message="md-maxlength">Máximo 256 caracteres</div> </div> </md-input-container> </div> <md-button type="submit" class="reportbtn" ng-if="!vm.reporting" layout="row" layout-align="center center"> <span>Reportar</span> <span class="btn-icon"></span> <!--<span class="btn-icon"></span>--> </md-button> <md-progress-circular ng-if="vm.reporting" md-mode="indeterminate"></md-progress-circular> </form> </md-sidenav>'),a.put("views/simplelist.html",'<div layout-align="center center" layout="row" flex layout-fill ng-if="vm.loadingReports"> <md-progress-circular md-mode="indeterminate"></md-progress-circular> </div> <md-list flex class="reports-list"> <md-list-item class="md-3-line md-long-text report" ng-repeat="report in vm.reports" layout="row" layout-wrap> <div class="img-container" flex-gt-sm="20" flex-md="30" flex="100" style="background-image: url(\'{{report.info.image}}\')"> <div class="overlay"></div> <div class="md-padding" style="position:relative"> <h2>{{report.source.domain}}</h2> <h3>{{report.motive}}</h3> <h3 ng-bind="report.createdAt | date:\'dd-MM-yyyy\'"></h3> </div> </div> <div flex-gt-sm="80" flex-md="70" flex="100" class="md-list-item-text md-padding"> <h3><a ng-href="{{report.link}}">{{ report.info.title }}</a></h3> <h4><a ng-href="{{report.link}}" target="_blank">{{report.link}}</a></h4> <p> {{report.info.description}} </p> </div> </md-list-item> <div> <button class="action-btn action-btn-block action-btn-inverted"> Cargar más </button> </div> </md-list>')}]);